#! /usr/bin/env zsh

echo "SCRIPT: $0"

set -euo pipefail

{{ $homebrew_prefix := "" -}}

{{ if eq .chezmoi.os "linux" }}

  # Starship
  apk add --no-cache starship

  # Zoxide
  curl -sS https://raw.githubusercontent.com/ajeetdsouza/zoxide/main/install.sh | bash

  # Kitty
  curl -L https://sw.kovidgoyal.net/kitty/installer.sh | sh /dev/stdin

{{ else if eq .chezmoi.os "darwin" }}

  # Homebrew
  {{- if eq .chezmoi.arch "x86_64" -}}
  {{-   $homebrew_prefix = "/usr/local" -}}
  {{- else -}}
  {{-   $homebrew_prefix = "/opt/homebrew" -}}
  {{- end }}

  if [ ! -x "{{ $homebrew_prefix }}/bin/brew" ]; then
    echo "Installing homebrew..."
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
  else
    echo "Found homebrew"
  fi

  # pkgx
  if [ ! -x /usr/local/bin/pkgx ]; then
    echo "Installing pkgx..."
    curl -fsS https://pkgx.sh | sh
  else
    echo "Found pkgx"
  fi

  # Kitty
  if [ ! -d "/Applications/kitty.app" ]; then
    echo "Installing kitty..."
    curl -L https://sw.kovidgoyal.net/kitty/installer.sh | sh /dev/stdin
  else
    echo "Found kitty"
  fi

{{ end }}
