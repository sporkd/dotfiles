#! /usr/bin/env zsh

{{ if eq .chezmoi.os "linux" }}

{{ else if eq .chezmoi.os "darwin" }}

  # Bundler
  ## Gemfile: {{ include "Gemfile.tmpl" | sha256sum }}
  echo "bundle install --gemfile=$HOME/Gemfile"
  bundle --version # install --gemfile="$HOME/Gemfile"

  # Homebrew
  ## Brewfile: {{ include "Brewfile.tmpl" | sha256sum }}

  {{- $homebrew_prefix := "/opt/homebrew" -}}
  {{- if eq .chezmoi.arch "x86_64" -}}
  {{-   $homebrew_prefix = "/usr/local" -}}
  {{- end }}

  if ! command -v brew &> /dev/null; then
    echo "Adding brew to path..."
    eval "$({{ $homebrew_prefix }}/bin/brew shellenv)"
  fi

  echo "brew bundle --file=$HOME/Brewfile"
  brew bundle --file="$HOME/Brewfile"

{{ end }}
